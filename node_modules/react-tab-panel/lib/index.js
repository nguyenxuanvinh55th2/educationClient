'use strict';Object.defineProperty(exports,'__esModule',{value:!0});exports.TabBody=exports.TabStrip=exports.Tab=void 0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&'function'==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=require('react'),_react2=_interopRequireDefault(_react),_reactDom=require('react-dom'),_reactClass=require('react-class'),_reactClass2=_interopRequireDefault(_reactClass),_objectAssign=require('object-assign'),_objectAssign2=_interopRequireDefault(_objectAssign),_reactFlex=require('react-flex'),_join=require('./join'),_join2=_interopRequireDefault(_join),_getTransitionEnd=require('./getTransitionEnd'),_getTransitionEnd2=_interopRequireDefault(_getTransitionEnd),_TabStrip=require('./TabStrip'),_TabStrip2=_interopRequireDefault(_TabStrip),_Body=require('./Body'),_Body2=_interopRequireDefault(_Body),_assignDefined=require('./assignDefined'),_assignDefined2=_interopRequireDefault(_assignDefined),_tabPositions=require('./tabPositions'),_tabPositions2=_interopRequireDefault(_tabPositions),_bemFactory=require('./bemFactory'),_bemFactory2=_interopRequireDefault(_bemFactory),_reactStyleNormalizer=require('react-style-normalizer'),_reactStyleNormalizer2=_interopRequireDefault(_reactStyleNormalizer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return call&&('object'==typeof call||'function'==typeof call)?call:self}function _inherits(subClass,superClass){if('function'!=typeof superClass&&null!==superClass)throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var CLASS_NAME='react-tab-panel',bem=(0,_bemFactory2.default)(CLASS_NAME),m=function m(a){return bem(null,a)},transitionWrapperClassName=CLASS_NAME+'__transition-wrapper',clone=function clone(a,d){var e=a.props;return a=(0,_react.cloneElement)(a,(0,_objectAssign2.default)({},e,d(e,a))),a},cloneDisplayNone=function cloneDisplayNone(a){return clone(a,function(d){var e=d?d.style:null;return{style:(0,_objectAssign2.default)({},e,{display:'none'})}})},cloneWithClassName=function cloneWithClassName(a,d){return clone(d,function(e){return{className:(0,_join2.default)(e&&e.className,a)}})},STRATEGIES={one:function one(a,d){return a[d]},all:function all(a,d){return a.map(function(e,f){return f!==d&&(e=cloneDisplayNone(e)),e})}},IN_CLASS_NAME='react-tab-panel__content--in',OUT_CLASS_NAME='react-tab-panel__content--out';var Tab=function(_Component){function Tab(){return _classCallCheck(this,Tab),_possibleConstructorReturn(this,Object.getPrototypeOf(Tab).apply(this,arguments))}return _inherits(Tab,_Component),_createClass(Tab,[{key:'render',value:function render(){return _react2.default.createElement('div',this.props)}}]),Tab}(_reactClass2.default);Tab.defaultProps={isTabPanelTab:!0};var TabPanel=function(_Component2){function TabPanel(a){_classCallCheck(this,TabPanel);var _this2=_possibleConstructorReturn(this,Object.getPrototypeOf(TabPanel).call(this,a));return _this2.state={oldActiveIndex:null,activeIndex:a.defaultActiveIndex||0},_this2.state={oldActiveIndex:null,activeIndex:a.defaultActiveIndex||0},_this2}return _inherits(TabPanel,_Component2),_createClass(TabPanel,[{key:'prepareClassName',value:function prepareClassName(a){return(0,_join2.default)(a.className,CLASS_NAME,m('orientation-'+(a.vertical?'vertical':'horizontal')),m('theme-'+a.theme),m('tab-align-'+a.tabAlign),m('tab-position-'+a.tabPosition))}},{key:'prepareProps',value:function prepareProps(a){var d=(0,_objectAssign2.default)({},a),e={},f=void 0,g=void 0,h=void 0,i=[],j=[];return _react2.default.Children.toArray(d.children).forEach(function(k,l){if(k){var _n=k.props;if(_n){if(_n.isTabStrip)return e=_n,void(g=l);_n.isTabBody&&(f=_n,h=l)}}}),_react2.default.Children.toArray(f?f.children:d.children).forEach(function(k){if(!k)return null;var l=k.props||{};l.isTabPanelTab?(i.push(l.children),d.transition&&k.props.children&&console.warn('You must only have one child in a Tab component when `transition` is true.')):i.push(k);var n=void 0;n=l.isTabPanelTab?(0,_objectAssign2.default)({},l,{children:null}):(0,_objectAssign2.default)({title:l.tabTitle||'',disabled:l.disabled},l.tabProps),j.push(n)}),d.tabs=j,d.activeIndex=this.prepareActiveIndex(d),d.tabPosition=this.prepareTabPosition(d,{tabStripIndex:g,tabBodyIndex:h}),d.vertical=d.vertical&&('left'==d.tabPosition||'right'==d.tabPosition),d.tabStrip=e,d.tabBody=f,d.children=i,d.transition&&(d.initialStrategy=d.strategy,d.strategy=this.transitionStrategy),d}},{key:'componentDidMount',value:function componentDidMount(){this.body.addEventListener((0,_getTransitionEnd2.default)(),this.onBodyTransitionEnd)}},{key:'componentWillUnmount',value:function componentWillUnmount(){this.body&&this.body.removeEventListener((0,_getTransitionEnd2.default)(),this.onBodyTransitionEnd)}},{key:'onBodyTransitionEnd',value:function onBodyTransitionEnd(){this.state.transitioning&&this.setState({transitioning:null,transitionInProgress:!1,wrapperStyle:null,oldActiveIndex:null})}},{key:'componentWillUpdate',value:function componentWillUpdate(a,d){var _this3=this,e=this.p.activeIndex,f=this.prepareActiveIndex(a,d);if(f!=e&&a.transition){var _ret=function(){if(!_this3.wrapper)return{v:void 0};var g=f>e?1:-1,h=function h(){return'one'==_this3.p.initialStrategy?_this3.wrapper.firstChild:_this3.wrapper.children[e]},i=function i(){return'one'==_this3.p.initialStrategy?1==g?_this3.wrapper.lastChild:_this3.wrapper.firstChild:_this3.wrapper.children[f]},j=h(),k=j&&j.offsetHeight||0,l={height:_this3.wrapper.offsetHeight};//at this point only 1 child should be rendered
_this3.state.transitioning&&_this3.onBodyTransitionEnd(),_this3.setState({transitioning:g,wrapperStyle:{height:l.height},oldActiveIndex:e},function(){_this3.wrapper||_this3.onBodyTransitionEnd();// debugger
var n=i(),o=l.height-k+(n&&n.offsetHeight||0);_this3.setState({transitioning:g,transitionInProgress:!0,wrapperStyle:{height:o}})})}();if('object'==('undefined'==typeof _ret?'undefined':_typeof(_ret)))return _ret.v}}},{key:'transitionStrategy',value:function transitionStrategy(a,d){var _this4=this,e=this.p.initialStrategy,f=STRATEGIES[e];f||console.warn('Strategy not supported for transition'),null==this.state.oldActiveIndex?a=f(a,d):'one'==e?function(){var h=[_this4.state.oldActiveIndex,d];//render them in the correct order
h.sort();var i=h[0],j=i==d,k=h[1],l=j?IN_CLASS_NAME:OUT_CLASS_NAME,n=j?OUT_CLASS_NAME:IN_CLASS_NAME;a=[clone(a[i],function(o){return{style:_this4.addTransitionDuration(o&&o.style),className:(0,_join2.default)(o&&o.className,l)}}),clone(a[k],function(o){return{style:_this4.addTransitionDuration(o&&o.style),className:(0,_join2.default)(o&&o.className,n)}})]}():a=a.map(function(h,i){return i!=d&&i!=_this4.state.oldActiveIndex?h=cloneDisplayNone(h):function(){var j=i==d?IN_CLASS_NAME:OUT_CLASS_NAME;h=clone(h,function(k){return{className:(0,_join2.default)(k&&k.className,j),style:_this4.addTransitionDuration(k.style)}})}(),h});var g=this.addTransitionDuration(this.state.wrapperStyle);return _react2.default.createElement('div',{ref:function ref(h){return _this4.wrapper=h},style:g,className:(0,_join2.default)(transitionWrapperClassName,this.props.vertical?transitionWrapperClassName+'--vertical':''),children:a})}},{key:'addTransitionDuration',value:function addTransitionDuration(a){return this.props.transitionDuration&&(a=(0,_objectAssign2.default)({},a,(0,_reactStyleNormalizer2.default)({transitionDuration:this.props.transitionDuration}))),a}},{key:'prepareTabPosition',value:function prepareTabPosition(a,_ref){var d=_ref.tabStripIndex,e=_ref.tabBodyIndex,f=a.tabPosition in _tabPositions2.default?a.tabPosition:'top';return!a.tabPosition&&void 0!==d&&void 0!==e&&d>e&&(f='bottom'),f}},{key:'prepareActiveIndex',value:function prepareActiveIndex(a,d){return null==a.activeIndex?(d||this.state).activeIndex:a.activeIndex}},{key:'render',value:function render(){var a=this.p=this.prepareProps(this.props),d=this.prepareClassName(a),e='top'==a.tabPosition||'left'==a.tabPosition,f='left'==a.tabPosition||'right'==a.tabPosition,g=_defineProperty({},f?'row':'column',!0);return _react2.default.createElement(_reactFlex.Flex,_extends({wrap:!1,alignItems:'stretch'},g,{inline:!0},a,{tabIndex:null,className:d}),e&&this.renderTabStrip(),this.renderBody(),!e&&this.renderTabStrip())}},{key:'onActivate',value:function onActivate(a){null==this.props.activeIndex&&this.setState({activeIndex:a}),this.props.onActivate(a)}},{key:'renderTabStrip',value:function renderTabStrip(){var a=this.p.tabs,_p=this.p,d=_p.activeIndex,e=_p.activateEvent,f=_p.onAddNew,g=_p.onCloseTab,h=_p.closeable,i=_p.scroller,j=_p.scrollSpringConfig,k=_p.scrollOnClick,l=_p.tabFactory,n=_p.tabStripFactory,o=_p.theme,p=_p.tabAlign,q=_p.tabStyle,r=_p.tabPosition,s=_p.tabEllipsis,t=_p.tabIndex,u=_p.vertical,v={activateEvent:e,onActivate:this.onActivate,activeIndex:d,tabFactory:l,tabAlign:p,theme:o,defaultTabs:a,tabPosition:r,inTabPanel:!0};(0,_assignDefined2.default)(v,{onAddNew:f,onCloseTab:g,closeable:h,scroller:i,scrollSpringConfig:j,scrollOnClick:k,vertical:u,tabStyle:q,tabEllipsis:s,tabIndex:t});var w=(0,_objectAssign2.default)({tabFactory:l},this.p.tabStrip,v),x=void 0;return n&&(x=n(w)),void 0==x&&(x=_react2.default.createElement(_TabStrip2.default,w)),x}},{key:'applyRenderStrategy',value:function applyRenderStrategy(_ref2){var a=_ref2.activeIndex,d=_ref2.children,e=_ref2.strategy,f=STRATEGIES[e];return'function'!=typeof f&&(f='function'==typeof e?e:STRATEGIES.all),f(d,a)}},{key:'renderBody',value:function renderBody(){var _this5=this,_p2=this.p,a=_p2.activeIndex,d=_p2.transition,e=_p2.vertical,f=this.applyRenderStrategy(this.p);this.p.tabBody||{};var g=(0,_objectAssign2.default)({},this.p.tabBody,{vertical:e,transition:d,transitionInProgress:this.state.transitionInProgress,activeIndex:a,tabPosition:this.p.tabPosition,children:f});return _react2.default.createElement(_Body2.default,_extends({ref:function ref(h){return _this5.body=(0,_reactDom.findDOMNode)(h)},transitioning:this.state.transitioning},g,this.state.bodyProps))}}]),TabPanel}(_reactClass2.default);exports.default=TabPanel;TabPanel.propTypes={tabStripFactory:_react.PropTypes.func,tabFactory:_react.PropTypes.func,strategy:_react.PropTypes.oneOfType([_react.PropTypes.oneOf(['one','all']),_react.PropTypes.func])},TabPanel.defaultProps={theme:'default',tabAlign:'start',onActivate:function onActivate(){},strategy:'one'};exports.Tab=Tab;exports.TabStrip=_TabStrip2.default;exports.TabBody=_Body2.default;