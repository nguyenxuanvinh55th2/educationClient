'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var _react=require('react'),_react2=_interopRequireDefault(_react),_reactDom=require('react-dom'),_reactClass=require('react-class'),_reactClass2=_interopRequireDefault(_reactClass),_objectAssign=require('object-assign'),_objectAssign2=_interopRequireDefault(_objectAssign),_hasTouch=require('has-touch'),_hasTouch2=_interopRequireDefault(_hasTouch),_reactNotifyResize=require('react-notify-resize'),_lodash=require('lodash.debounce'),_lodash2=_interopRequireDefault(_lodash),_reactFlex=require('react-flex'),_reactMotion=require('react-motion'),_join=require('../join'),_join2=_interopRequireDefault(_join),_bemFactory=require('../bemFactory'),_bemFactory2=_interopRequireDefault(_bemFactory);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return call&&('object'==typeof call||'function'==typeof call)?call:self}function _inherits(subClass,superClass){if('function'!=typeof superClass&&null!==superClass)throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var CLASS_NAME='react-tab-panel__tab-strip-scroll-tool',bem=(0,_bemFactory2.default)(CLASS_NAME),m=function m(a){return bem(null,a)},styles={},ARROWS={right:_react2.default.createElement('svg',{className:(0,_join2.default)(bem('arrow'),bem('arrow','right')),height:'18',viewBox:'0 0 24 24',width:'18',xmlns:'http://www.w3.org/2000/svg'},_react2.default.createElement('path',{d:'M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z'}),_react2.default.createElement('path',{d:'M0-.25h24v24H0z',fill:'none'})),left:_react2.default.createElement('svg',{className:(0,_join2.default)(bem('arrow'),bem('arrow','left')),height:'18',viewBox:'0 0 24 24',width:'18',xmlns:'http://www.w3.org/2000/svg'},_react2.default.createElement('path',{d:'M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z'}),_react2.default.createElement('path',{d:'M0-.5h24v24H0z',fill:'none'})),down:_react2.default.createElement('svg',{className:(0,_join2.default)(bem('arrow'),bem('arrow','down')),height:'18',viewBox:'0 0 24 24',width:'18',xmlns:'http://www.w3.org/2000/svg'},_react2.default.createElement('path',{d:'M7.41 7.84L12 12.42l4.59-4.58L18 9.25l-6 6-6-6z'}),_react2.default.createElement('path',{d:'M0-.75h24v24H0z',fill:'none'})),up:_react2.default.createElement('svg',{className:(0,_join2.default)(bem('arrow'),bem('arrow','up')),height:'18',viewBox:'0 0 24 24',width:'18',xmlns:'http://www.w3.org/2000/svg'},_react2.default.createElement('path',{d:'M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z'}),_react2.default.createElement('path',{d:'M0 0h24v24H0z',fill:'none'}))},emptyFn=function emptyFn(){},stop=function stop(a){a.preventDefault(),a.stopPropagation()};var Scroller=function(_Component){function Scroller(a){_classCallCheck(this,Scroller);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Scroller).call(this,a));return _this.onResize=(0,_lodash2.default)(_this.onResize,50,{leading:!1,trailing:!0}),_this.scrollInfo={scrollPos:0,adjustScroll:!0,hasStartScroll:!1,hasEndScroll:!1,scrollerSize:{start:0,end:0}},_this.state={scrolling:!1,activeScroll:0},_this.onResize=(0,_lodash2.default)(_this.onResize,50,{leading:!1,trailing:!0}),_this}return _inherits(Scroller,_Component),_createClass(Scroller,[{key:'getOffsetSizeName',value:function getOffsetSizeName(){var a=this.props.tabPosition;return'top'==a||'bottom'==a?'offsetWidth':'offsetHeight'}},{key:'getSizeName',value:function getSizeName(){var a=this.props.tabPosition;return'top'==a||'bottom'==a?'width':'height'}},{key:'componentDidMount',value:function componentDidMount(){var a=this.getOffsetSizeName();this.scrollInfo.scrollerSize={start:(0,_reactDom.findDOMNode)(this.refs.start)[a],end:(0,_reactDom.findDOMNode)(this.refs.end)[a]},this.syncScroll({force:!0})}},{key:'onResize',value:function onResize(){delete this.currentListSize,delete this.availableSize,this.syncScroll({force:!0})}},{key:'syncScroll',value:function syncScroll(){var _ref=0>=arguments.length||void 0===arguments[0]?{}:arguments[0],a=_ref.force;this.updateScrollInfo(),this.doScroll(0,null,{force:a})}},{key:'scrollIntoView',value:function scrollIntoView(a){if(a){var b=a.getBoundingClientRect(),d=(0,_reactDom.findDOMNode)(this.wrapper||this).getBoundingClientRect(),f=this.props.tabPosition,g='top'==f||'bottom'==f?'left':'top',h='top'==f||'bottom'==f?'right':'bottom',i=b[g]-d[g],j=b[h]-d[h],k=this.props.scrollIntoViewOffset;0>i?this.doScroll(-i+k,-1):0<j&&this.doScroll(j+k,1)}}},{key:'doScroll',value:function doScroll(a,b){var _ref2=2>=arguments.length||void 0===arguments[2]?{}:arguments[2],d=_ref2.force,f=this.scrollInfo,g=f.scrollPos+a*(b||this.props.scrollStep);this.setScrollPosition(g,{force:d})}},{key:'scrollBy',value:function scrollBy(a,b){var _ref3=2>=arguments.length||void 0===arguments[2]?{}:arguments[2],d=_ref3.force,f=this.scrollInfo,g=f.scrollPos+b*a;this.setScrollPosition(g,{force:d})}},{key:'onClick',value:function onClick(a){var b=this.getAvailableSize();this.scrollBy(b,a)}},{key:'setScrollPosition',value:function setScrollPosition(a){var _ref4=1>=arguments.length||void 0===arguments[1]?{}:arguments[1],b=_ref4.force,d=this.scrollInfo;a>d.maxScrollPos&&(a=d.maxScrollPos),0>a&&(a=0),a===d.scrollPos&&!0!==b||((0,_objectAssign2.default)(d,{hasStartScroll:0!==a,hasEndScroll:a<d.maxScrollPos,scrollPos:a}),this.setState({}))}},{key:'updateScrollInfo',value:function updateScrollInfo(){var a=this.getAvailableSize(),b=this.getCurrentListSize(),d=(0,_objectAssign2.default)(this.scrollInfo,{availableSize:a,listSize:b});d.maxScrollPos=b>a?b-a:0,d.hasStartScroll=0!=d.scrollPos,d.hasEndScroll=d.scrollPos<d.maxScrollPos}},{key:'handleScrollMax',value:function handleScrollMax(a,b){stop(b);var d=-1==a?0:this.scrollInfo.maxScrollPos;this.setScrollPosition(d)}},{key:'startScroll',value:function startScroll(a){var _this2=this,b=_hasTouch2.default?'touchend':'mouseup',d=function d(){_this2.stopScroll(),global.removeEventListener(b,d)};global.addEventListener(b,d),this.scrollInterval=global.setInterval(this.doScroll.bind(this,a),this.props.scrollSpeed),this.setState({scrolling:!0,activeScroll:a})}},{key:'stopScroll',value:function stopScroll(){global.clearInterval(this.scrollInterval),this.setState({scrolling:!1,activeScroll:0})}},{key:'renderScroller',value:function renderScroller(a){var _props=this.props,b=_props.scroller,d=_props.vertical,f=_props.tabPosition;if(!b)return null;d?-1==a?'up':'down':-1==a?'left':'right';var g='top'==f||'bottom'==f?-1==a?'left':'right':-1==a?'up':'down',h='boolean'==typeof b?b?'on':'off':'auto',i=this.scrollInfo,j=-1==a?!i.hasStartScroll:!i.hasEndScroll,k=(0,_join2.default)(CLASS_NAME,m(h),m('direction-'+g),m('tab-position-'+f),this.state.activeScroll==a?m('active'):'','auto'===b&&j&&m('hidden'),!0===b&&j&&m('disabled')),l=!j&&this.props.scrollOnClick?this.onClick.bind(this,a):emptyFn,n=j||this.props.scrollOnClick?emptyFn:this.startScroll.bind(this,a),o=j?emptyFn:this.handleScrollMax.bind(this,a),p={ref:-1==a?'start':'end',disabled:j,className:k,onClick:l,onMouseDown:!_hasTouch2.default&&n,onTouchStart:_hasTouch2.default&&n,onDoubleClick:o,children:ARROWS[g]},q=void 0;return this.props.renderScroller&&(q=this.props.renderScroller(p)),void 0==q&&(q=_react2.default.createElement('div',p)),q}/**
   * Cache the current list width on this instance.
   *
   * It will be invalidated by onResize
   *
   * @return {Number}
   */},{key:'getCurrentListSize',value:function getCurrentListSize(){return this.currentListSize=this.currentListSize||(0,_reactDom.findDOMNode)(this.strip)[this.getOffsetSizeName()]}/**
   * Cache the available width on this instance.
   *
   * It will be invalidated by onResize
   *
   * @return {Number}
   */},{key:'getAvailableSize',value:function getAvailableSize(){return this.availableSize=this.availableSize||(0,_reactDom.findDOMNode)(this.wrapper||this)[this.getOffsetSizeName()]}},{key:'render',value:function render(){var _this3=this,a=this.props,b=a.scroller,d=a.tabPosition,f=this.scrollInfo,g='top'==d||'bottom'==d?'left':'top',h=_defineProperty({},g,(0,_reactMotion.spring)(-f.scrollPos,a.scrollSpringConfig)),i=_react2.default.createElement(_reactNotifyResize.NotifyResize,{key:'resizer',onResize:this.onResize}),j=[a.childProps.children,i];return _react2.default.createElement(_reactFlex.Flex,_extends({ref:null},a),i,this.renderScroller(-1),_react2.default.createElement(_reactMotion.Motion,{style:h},function(_ref5){var k=_ref5[g],l=_react2.default.createElement(_reactFlex.Flex,_extends({},a.childProps,{ref:function ref(n){return _this3.strip=n},children:j,style:_defineProperty({},g,k)}));return!0===b?_react2.default.createElement(_reactFlex.Flex,{ref:function ref(n){return _this3.wrapper=n},className:'react-tab-panel__tab-strip-scroll-wrap',row:!0,flexGrow:1,flexShrink:1,wrap:!1,alignItems:'stretch'},l):l}),this.renderScroller(1))}}]),Scroller}(_reactClass2.default);exports.default=Scroller;Scroller.propTypes={/**
   * When true, scrolling will only happen on click
   * and will scroll all visible tabs to a given direction
   *
   * When false, scrolling will happen on mouseDown
   *
   * @type {Boolean}
   */scrollOnClick:_react.PropTypes.bool,scroller:_react.PropTypes.oneOf(['auto',!1,!0])},Scroller.defaultProps={onScrollEnd:function onScrollEnd(){},scrollStep:15,scrollSpeed:10,scrollSpringConfig:{stiffness:370,damping:60},scrollIntoViewOffset:50,onScrollerClick:function onScrollerClick(){},onScrollEnd:function onScrollEnd(){}};