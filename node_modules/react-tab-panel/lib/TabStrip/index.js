'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var _react=require('react'),_react2=_interopRequireDefault(_react),_reactDom=require('react-dom'),_reactClass=require('react-class'),_reactClass2=_interopRequireDefault(_reactClass),_objectAssign=require('object-assign'),_objectAssign2=_interopRequireDefault(_objectAssign),_reactFlex=require('react-flex'),_tabPositions=require('../tabPositions'),_tabPositions2=_interopRequireDefault(_tabPositions),_join=require('../join'),_join2=_interopRequireDefault(_join),_TabTitle=require('../TabTitle'),_TabTitle2=_interopRequireDefault(_TabTitle),_bemFactory=require('../bemFactory'),_bemFactory2=_interopRequireDefault(_bemFactory),_Scroller=require('./Scroller'),_Scroller2=_interopRequireDefault(_Scroller);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return call&&('object'==typeof call||'function'==typeof call)?call:self}function _inherits(subClass,superClass){if('function'!=typeof superClass&&null!==superClass)throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var CLASS_NAME='react-tab-panel__tab-strip',NEW_TAB=_react2.default.createElement('svg',{height:'20',viewBox:'0 0 24 24',width:'20',xmlns:'http://www.w3.org/2000/svg'},_react2.default.createElement('path',{d:'M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z'}),_react2.default.createElement('path',{d:'M0 0h24v24H0z',fill:'none'})),bem=(0,_bemFactory2.default)(CLASS_NAME),m=function m(a){return bem(null,a)};var TabStrip=function(_Component){function TabStrip(a){_classCallCheck(this,TabStrip);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(TabStrip).call(this,a));return _this.state={focused:!1,activeIndex:a.defaultActiveIndex||0},_this.tabNodes=[],_this.state={focused:!1,activeIndex:a.defaultActiveIndex||0},_this}return _inherits(TabStrip,_Component),_createClass(TabStrip,[{key:'componentDidUpdate',value:function componentDidUpdate(a,d){var _this2=this,e=this.prepareActiveIndex(a,d);e!=this.p.activeIndex&&function(){var f=_this2.p.activeIndex;_this2.scrollToTab(f),setTimeout(function(){f===_this2.p.activeIndex&&_this2.scrollToTab(f)},100)}()}},{key:'scrollToTab',value:function scrollToTab(a){var d=this.tabNodes[a];d&&this.scroller&&this.scroller.scrollIntoView(d)}},{key:'prepareClassName',value:function prepareClassName(a){return(0,_join2.default)(a.className,CLASS_NAME,m('theme-'+a.theme),m('tab-align-'+a.tabAlign),m('tab-position-'+a.tabPosition),m('orientation-'+(a.vertical?'vertical':'horizontal')),a.focused&&m('focused'),a.vertical&&m('vertical'),a.firstActive&&m('first-active'),a.lastActive&&m('last-active'))}},{key:'prepareActiveIndex',value:function prepareActiveIndex(a,d){return null==a.activeIndex?(d||this.state).activeIndex:a.activeIndex}},{key:'prepareProps',value:function prepareProps(a){var d=(0,_objectAssign2.default)({},a),e=this.prepareActiveIndex(d);return d.activeIndex=e,d.tabs=d.defaultTabs||d.tabs,d.onAddNew&&(d.tabs=[].concat(_toConsumableArray(d.tabs),[{title:NEW_TAB,selectable:!1,closeable:!1,onMouseDown:function onMouseDown(){d.onAddNew()}}])),d.tabIndex='boolean'==typeof d.tabIndex?d.tabIndex?0:-1:d.tabIndex,this.tabNodes.length=d.tabs.length,d.firstActive=0===e,d.lastActive=e===d.tabs.length-1,d.allTabsProps=[],d.onFocus=this.onFocus,d.onBlur=this.onBlur,d.onKeyDown=this.onKeyDown,d.focused=this.state.focused,d}},{key:'render',value:function render(){var _this3=this,a=this.p=this.prepareProps(this.props),d=this.prepareClassName(a),e=(0,_join2.default)(bem('before'),a.firstActive&&bem('before','before-active')),f=(0,_join2.default)(bem('after'),a.lastActive&&bem('after','after-active')),g=a.tabPosition,h='top'==g||'bottom'==g,i=(0,_objectAssign2.default)({},a,{alignItems:'stretch',row:h,column:!h,wrap:!1,className:d}),j={className:bem('inner'),alignItems:'stretch',row:h,column:!h,wrap:!1,children:[_react2.default.createElement(_reactFlex.Item,{className:e}),a.tabs.map(this.renderTab),_react2.default.createElement(_reactFlex.Item,{className:f})]};return!1===a.scroller?_react2.default.createElement(_reactFlex.Flex,i,_react2.default.createElement(_reactFlex.Flex,j)):_react2.default.createElement(_Scroller2.default,_extends({ref:function ref(k){return _this3.scroller=_this3.scroller||k}},i,{childProps:j}))}},{key:'onResize',value:function onResize(){}},{key:'onFocus',value:function onFocus(a){this.setState({focused:!0}),this.props.onFocus(a,(0,_reactDom.findDOMNode)(this))}},{key:'onBlur',value:function onBlur(a){this.setState({focused:!1}),this.props.onBlur(a)}},{key:'onKeyDown',value:function onKeyDown(a){var d=a.key;'function'==typeof this.props.onKeyDown&&this.props.onKeyDown(a);var e=0;return'ArrowLeft'==d||'ArrowUp'==d?e=-1:('ArrowRight'==d||'ArrowDown'==d)&&(e=1),e?this.onNavigate(e):'Home'===d?this.onNavigateFirst():'End'==d?this.onNavigateLast():void 0}},{key:'renderTab',value:function renderTab(a,d){var _this4=this,e=this.p,f=e.activeIndex,g=e.activateEvent,h=e.inTabPanel,i=e.tabStyle,j=e.tabEllipsis,k=e.vertical,l=e.tabAlign,n=e.closeable;'string'==typeof a&&(a={title:a});var o=e.tabs.length-1===d,p=f-1===d,q=d===f,r=(0,_objectAssign2.default)({closeable:n},a,{ref:function ref(u){return _this4.tabNodes[d]=(0,_reactDom.findDOMNode)(u)},index:d,activateEvent:g,activeIndex:f,active:q,first:0===d,last:o,beforeActive:p,afterActive:f+1===d,tabAlign:l,tabTitle:a.title,children:a.title,vertical:k,tabStyle:i,tabEllipsis:j,key:d});r.onActivate=this.onActivate.bind(this,d),r.onClose=this.onClose.bind(this,d,a),delete r.title,e.allTabsProps.push(r);var s=void 0;e.tabFactory&&(s=e.tabFactory(r)),void 0==s&&(s=_react2.default.createElement(_TabTitle2.default,r));var t=(0,_join2.default)(bem('between'),p&&bem('between','before-active'),q&&bem('between','after-active'));return[s,!o&&_react2.default.createElement(_reactFlex.Item,{className:t})]}},{key:'onNavigate',value:function onNavigate(a){var d=this.p.activeIndex;this.onActivate(this.getAvailableIndexFrom(d,a,this.props.rotateNavigation))}},{key:'onNavigateFirst',value:function onNavigateFirst(){this.onActivate(this.getFirstAvailableIndex())}},{key:'onNavigateLast',value:function onNavigateLast(){this.onActivate(this.getLastAvailableIndex())}},{key:'onClose',value:function onClose(a,d){this.props.onCloseTab(a),d.onClose&&d.onClose()}},{key:'onActivate',value:function onActivate(a){if(this.p.allTabsProps[a]){var _d=this.p.tabs[a];!this.isSelectableTab(_d)||_d&&_d.onActivate&&!1===_d.onActivate()||(null==this.props.activeIndex&&this.setState({activeIndex:a}),a!=this.p.activeIndex&&this.props.onActivate(a))}}},{key:'getAvailableIndexFrom',value:function getAvailableIndexFrom(a,d,e){var f=this.p.allTabsProps||[];f.length;var g=void 0,h=void 0;e&&(g=this.getFirstAvailableIndex(),h=this.getLastAvailableIndex());for(var _i=void 0,_j=function _j(l){return e&&(l<g?l=h:l>h&&(l=g)),l},_k=_j(a+d);_i=f[_k];){if(this.isSelectableTab(_i))return _k;_k=_j(_k+d)}return-1}},{key:'isSelectableTab',value:function isSelectableTab(a){var d=a;return'number'==typeof a&&(d=this.p.allTabsProps[a]),!d.disabled&&!1!==d.selectable}},{key:'getFirstAvailableIndex',value:function getFirstAvailableIndex(){return this.getAvailableIndexFrom(-1,1)}},{key:'getLastAvailableIndex',value:function getLastAvailableIndex(){var a=this.p.allTabsProps||[];return this.getAvailableIndexFrom(a.length,-1)}}]),TabStrip}(_reactClass2.default);exports.default=TabStrip;TabStrip.propTypes={tabStyle:_react.PropTypes.oneOfType([_react.PropTypes.func,_react.PropTypes.object]),rotateNavigation:_react.PropTypes.bool,scroller:_react.PropTypes.oneOf([!0,!1,'auto']),tabIndex:_react.PropTypes.oneOfType([_react.PropTypes.bool,_react.PropTypes.number]),tabEllipsis:_react.PropTypes.bool,tabPosition:_react.PropTypes.oneOf(['top','bottom','left','right']),vertical:function vertical(a,d){var e=a[d];if(e&&'left'!=a.tabPosition&&'right'!=a.tabPosition)return new Error('You can only have "vertical" tabs if "tabPosition" is one of "left", "right".')},tabAlign:_react.PropTypes.oneOf(['start','center','end','space-around','space-between','stretch']),tabPosition:_react.PropTypes.oneOf(Object.keys(_tabPositions2.default))},TabStrip.defaultProps={scroller:'auto',scrollOnClick:!1,rotateNavigation:!0,tabIndex:!0,tabAlign:'start',tabPosition:'top',theme:'default',onActivate:function onActivate(){},onCloseTab:function onCloseTab(){},onBlur:function onBlur(){},onFocus:function onFocus(){},isTabStrip:!0};